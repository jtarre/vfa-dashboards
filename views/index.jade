extends layout

block content
	h1= title
	p#responseResult
	h2= "Select Fellow"
	select#fellow.chosen-select(data-placeholder="Select a Fellow")(tabindex="-1")
		option(value="")
		each id, name in fellowList
			option(id=id) #{name}
	br
	h2= "Log Notes"
	label Subject 
	input(id="subject")(style="width: 250px")
	br
	label Notes 
	textarea(id="notes" style="width: 250px; height: 75px")
	br
	label User 
	select#vfaList.chosen-select(data-placeholder="Choose Yourself")
		each id, name in vfaList
			option(id=id) #{name}
	br
	br
	button#logNotes Log Notes
	p#noteSubmission
	p#results
	//h2= "CoPa Potential Partners"
	//each record, index in results 
		//p= record.Name
	script.
			$(".chosen-select").chosen();
	script.
		$("#fellow").change(function(e){
			console.log("Here!");
			//e.preventDefault();
			var sfId = $(this).find('option:selected').attr("id");
			console.log(sfId);
			$('#results').html("Loading...");
			$.get("users", {id: sfId}, function ( data ) {
				console.log("data: " + data)
				$('#results').html(data);
			});
		})
	script.
		$("#logNotes").click(function(e){
			console.log("clicked!");

			var fellowId = $("#fellow").find('option:selected').attr("id");
			console.log("fellow salesforce id: " + fellowId);
			
			var subject    = $("#subject").val();
			var notes      = $("#notes").val();
			var vfaId      = $("#vfaList").find('option:selected').attr("id");

			// FOR SLACK // 
			var fellowName = $("#fellow").find('option:selected').val();
			var userName   = $("#vfaList").find('option:selected').val();
			
			console.log("subject: " + subject);
			console.log("notes: " + notes);
			console.log("vfa id: " + vfaId);
			console.log("fellow id: ")

			$.post("lognotes", {
				fellowId    : fellowId,
				vfaId       : vfaId,   
				subject     : subject, 
				description : notes,
				fellowName  : fellowName, 
				userName    : userName
			})
			 .done( function ( data ) {
				//alert("Data loaded!: " + data);
				console.log( data );
				$('#responseResult').html(data);
			});
		})



